<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:C4iSytemsMobApp"
             xmlns:models="clr-namespace:C4iSytemsMobApp.Models"
             x:Class="C4iSytemsMobApp.HrRecordsPage"
             Title="HR Records">

    <Grid RowDefinitions="Auto,Auto,*,Auto"
          Padding="20"
          RowSpacing="10">

        <!-- Top Bar -->
        <Grid ColumnDefinitions="Auto,*,Auto"
              VerticalOptions="Center"
              Grid.Row="0">
            <Label Text="Compliance"
                   FontSize="18"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   Grid.Column="1"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <!-- Home Button -->
            <ImageButton Source="home.png"
                         Clicked="OnHomeClicked"
                         HeightRequest="30"
                         WidthRequest="30"
                         BackgroundColor="Transparent"
                         HorizontalOptions="End"
                         VerticalOptions="Center"
                         Grid.Column="2" />
        </Grid>

        <VerticalStackLayout Grid.Row="1"
                             Spacing="5">
            <!-- Settings Button -->
            <Frame CornerRadius="9"
                   HasShadow="False"
                   BorderColor="Transparent"
                   Margin="5,0,0,0"
                   Padding="1"
                   HeightRequest="46"
                   HorizontalOptions="Fill"
                   VerticalOptions="Center">

                <Frame.Background>
                    <LinearGradientBrush>
                        <GradientStop Color="#007AFF"
                                      Offset="0.0" />
                        <GradientStop Color="#0056B3"
                                      Offset="1.0" />
                    </LinearGradientBrush>
                </Frame.Background>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnAddComplianceClicked" />
                </Frame.GestureRecognizers>
                <HorizontalStackLayout Padding="0,0"
                                       Spacing="10"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       HeightRequest="46">
                    <Label Text="&#xf067;"
                           TextColor="White"
                           FontFamily="FontAwesome"
                           FontSize="15"
                           VerticalOptions="Center"
                           HorizontalOptions="Center">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnAddComplianceClicked" />
                        </Label.GestureRecognizers>
                    </Label>

                    <Label x:Name="AddCompliance"
                           Padding="1,1,3,3"
                           Text="Add Compaliance"
                           TextColor="White"
                           FontSize="20"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Frame>
            <Label x:Name="ActionInfo"
                   Padding="1"
                   Text="Swipe Right to Edit, Left to Delete, Click on a record to view."
                   TextColor="White"
                   FontSize="8"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />
        </VerticalStackLayout>
        
        <!-- Scrollable CollectionView -->
        <CollectionView x:Name="LogsCollectionView"
                        Grid.Row="2"
                        Margin="0,3,0,0"
                        ItemsSource="{Binding HrRecords}"
                        SelectionMode="None"
                        VerticalOptions="FillAndExpand">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <!-- WRAPPER: controls spacing between items -->
                    <Grid Margin="0,0,0,5">
                        <SwipeView>
                            <!-- Swipe LEFT → Delete (Left Side) -->
                            <SwipeView.RightItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItemView HorizontalOptions="Start"
                                                   Command="{Binding Source={RelativeSource AncestorType={x:Type local:HrRecordsPage}},Path=BindingContext.DeleteCommand}"
                                                   CommandParameter="{Binding .}">                                        
                                        <Frame Margin="1"
                                               Padding="1"
                                               CornerRadius="10"
                                               BorderColor="LightGray"
                                               BackgroundColor="Red"
                                               HorizontalOptions="StartAndExpand"
                                               VerticalOptions="Fill"
                                               WidthRequest="100">
                                            <Label Text="&#xf014;"
                                                   FontFamily="FontAwesome"
                                                   FontSize="28"
                                                   TextColor="White"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                        </Frame>
                                    </SwipeItemView>
                                </SwipeItems>

                            </SwipeView.RightItems>

                            <!-- Swipe RIGHT → Edit (Right Side) -->
                            <SwipeView.LeftItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItemView HorizontalOptions="Start"
                                                   Command="{Binding Source={RelativeSource AncestorType={x:Type local:HrRecordsPage}},Path=BindingContext.EditCommand}"
                                                   CommandParameter="{Binding .}">                                        
                                        <Frame Margin="1"
                                               Padding="1"
                                               CornerRadius="10"
                                               BorderColor="LightGray"
                                               BackgroundColor="Green"
                                               HorizontalOptions="StartAndExpand"
                                               VerticalOptions="Fill"
                                               WidthRequest="100">
                                            <Label Text="&#xf044;"
                                                   FontFamily="FontAwesome"
                                                   FontSize="28"
                                                   TextColor="White"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center" />
                                        </Frame>
                                    </SwipeItemView>
                                </SwipeItems>
                            </SwipeView.LeftItems>

                            <!-- Card Content -->
                            <Frame Margin="1"
                                   Padding="15"
                                   CornerRadius="10"
                                   BorderColor="LightGray"
                                   BackgroundColor="Green">

                                <!-- Status-based background -->
                                <Frame.Triggers>
                                    <DataTrigger TargetType="Frame"
                                                 Binding="{Binding StatusColor}"
                                                 Value="green">
                                        <Setter Property="BackgroundColor"
                                                Value="#05b02d" />
                                    </DataTrigger>

                                    <DataTrigger TargetType="Frame"
                                                 Binding="{Binding StatusColor}"
                                                 Value="red">
                                        <Setter Property="BackgroundColor"
                                                Value="#f0201d" />
                                    </DataTrigger>

                                    <DataTrigger TargetType="Frame"
                                                 Binding="{Binding StatusColor}"
                                                 Value="yellow">
                                        <Setter Property="BackgroundColor"
                                                Value="Yellow" />
                                    </DataTrigger>
                                </Frame.Triggers>

                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnHrRecordClicked" />
                                </Frame.GestureRecognizers>

                                <!-- MAIN LAYOUT -->
                                <Grid VerticalOptions="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                                    </Grid.ColumnDefinitions>

                                    <!-- Text Content (Center) -->
                                    <VerticalStackLayout Grid.Column="1"
                                                         Margin="10,0"
                                                         VerticalOptions="Center">

                                        <HorizontalStackLayout Spacing="5">
                                            <Label Text="HR Group: "
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="Black">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>

                                            <Label Text="{Binding HrGroupText}"
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="Black">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                        </HorizontalStackLayout>

                                        <Grid ColumnDefinitions="Auto,*"
                                              ColumnSpacing="5">
                                            <Label Text="Desc: "
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="Black"
                                                   VerticalOptions="Start">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                            <Label Grid.Column="1"
                                                   Text="{Binding Description}"
                                                   FontAttributes="Bold"
                                                   FontSize="12"
                                                   TextColor="Black"
                                                   LineBreakMode="WordWrap"
                                                   HorizontalOptions="FillAndExpand">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                        </Grid>

                                        <HorizontalStackLayout Spacing="5">
                                            <Label Text="Expiry/Issue Date: "
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="Black">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding DateType}"
                                                                 Value="True">
                                                        <Setter Property="Text"
                                                                Value="Issue Date: " />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding DateType}"
                                                                 Value="False">
                                                        <Setter Property="Text"
                                                                Value="Expiry Date: " />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>

                                            <Label Text="{Binding ExpiryDate, StringFormat='{0:dd-MMM-yyyy}'}"
                                                   FontAttributes="Bold"
                                                   FontSize="12"
                                                   TextColor="Black">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                        </HorizontalStackLayout>

                                        <Grid ColumnDefinitions="Auto,*"
                                              ColumnSpacing="5">
                                            <Label Text="File: "
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="Black"
                                                   VerticalOptions="Start">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                            <Label Grid.Column="1"
                                                   Text="{Binding FileName}"
                                                   FontAttributes="Bold"
                                                   FontSize="12"
                                                   TextColor="Black"
                                                   LineBreakMode="WordWrap"
                                                   HorizontalOptions="FillAndExpand">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="green">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="red">
                                                        <Setter Property="TextColor"
                                                                Value="White" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label"
                                                                 Binding="{Binding StatusColor}"
                                                                 Value="yellow">
                                                        <Setter Property="TextColor"
                                                                Value="Black" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                        </Grid>
                                    </VerticalStackLayout>
                                </Grid>
                            </Frame>

                        </SwipeView>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>


        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay"
              BackgroundColor="#80000000"
              IsVisible="False"
              Grid.RowSpan="3"
              VerticalOptions="FillAndExpand"
              HorizontalOptions="FillAndExpand">
            <StackLayout VerticalOptions="Center"
                         HorizontalOptions="Center">
                <ActivityIndicator IsRunning="True"
                                   Color="White"
                                   WidthRequest="50"
                                   HeightRequest="50" />
                <Label Text="Loading..."
                       TextColor="White"
                       FontSize="18"
                       HorizontalOptions="Center"
                       Margin="0,10,0,0" />
            </StackLayout>
        </Grid>


        <!-- Add Compliance -->
        <Grid x:Name="PopupOverlayAddCompliance"
              BackgroundColor="#80000000"
              IsVisible="False">

            <Frame x:Name="AddComplianceFrame"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=Black}"
                   CornerRadius="12"
                   Padding="10"
                   Margin="8"
                   HasShadow="True"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   MaximumWidthRequest="480">

                <ScrollView MaximumHeightRequest="650">

                    <Grid>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"
                                           x:Name="HeaderLabel" />
                            <RowDefinition Height="Auto"
                                           x:Name="Notes" />
                            <RowDefinition Height="Auto"
                                           x:Name="HRGroup" />
                            <RowDefinition Height="Auto"
                                           x:Name="Description" />
                            <RowDefinition Height="Auto"
                                           x:Name="ExpiryOrIssueDate" />
                            <RowDefinition Height="Auto"
                                           x:Name="AddFileNote" />
                            <RowDefinition Height="*"
                                           x:Name="filenames" />
                            <RowDefinition Height="*"
                                           x:Name="SaveButton" />
                            <RowDefinition Height="*"
                                           x:Name="CancelButton" />
                        </Grid.RowDefinitions>

                        <!-- Popup HeaderLabel -->
                        <Label Grid.Row="0"
                               Text="Add/Edit Compliance"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=Black, Dark=White}"
                               HorizontalOptions="Center"
                               Margin="0,0,0,18" />



                        <!-- Notes -->
                        <VerticalStackLayout Grid.Row="1"
                                             Spacing="2">
                            <Label Text="The HR database allows uploads of compliance and license documents based on three groups. Please read legend and select the correct group first, before selecting the description of the file you are uploading. If a document you are trying to upload is not listed in the dropdown description list, please contact admin"
                                   VerticalOptions="Center"
                                   FontSize="9"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                   LineBreakMode="WordWrap"
                                   LineHeight="1.3"
                                   HorizontalTextAlignment="Start" />


                            <Label Text="LEGEND"
                                   VerticalOptions="Center"
                                   FontSize="9"
                                   Margin="0,6,0,0"
                                   TextDecorations="Underline"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                            <Label Text="HR 1=C4i Onboarding (CV,LICENSES,C4i Training)"
                                   VerticalOptions="Center"
                                   FontSize="9"
                                   Margin="0,3,0,0"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                            <Label Text="HR 2=Client inductions (client specific SOPs)"
                                   VerticalOptions="Center"
                                   FontSize="9"
                                   Margin="0,2,0,0"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                            <Label Text="HR 3=Special skills (FLIR,WARDEN,COXSWAIN,etc)"
                                   VerticalOptions="Center"
                                   FontSize="9"
                                   Margin="0,2,0,0"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                        </VerticalStackLayout>

                        <!-- HRGroup -->
                        <VerticalStackLayout Grid.Row="2"
                                             Spacing="2">

                            <!--<Label x:Name="LabelHRGroup"
                                   Text="HR Group"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />-->
                            <!-- HR Group Picker -->
                            <Picker x:Name="HrGroupPicker"
                                    Title="HR Group"
                                    TitleColor="{AppThemeBinding Light=Black, Dark=White}"
                                    TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                    ItemsSource="{Binding HrGroupsList}"
                                    SelectedIndexChanged="OnHrGroupSelectionChanged"
                                    IsVisible="True" />

                        </VerticalStackLayout>

                        <!--ItemDisplayBinding="{Binding Name}"-->

                        <!-- Description -->
                        <VerticalStackLayout Grid.Row="3"
                                             Spacing="2">

                            <!--<Label x:Name="LabelDescription"
                                   Text="Description"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />-->
                            <!-- Description Picker -->
                            <Picker x:Name="DescriptionGroupPicker"
                                    Title="Description"
                                    TitleColor="{AppThemeBinding Light=Black, Dark=White}"
                                    TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                    ItemsSource="{Binding HrDescriptionList}"
                                    ItemDisplayBinding="{Binding DisplayDescription}"
                                    SelectedIndexChanged="OnDescriptionGroupSelectionChanged"
                                    IsVisible="True" />

                        </VerticalStackLayout>

                        <!-- ExpiryOrIssueDate -->
                        <VerticalStackLayout Grid.Row="4"
                                             Spacing="2"
                                             Margin="0,2,0,2"
                                             BindingContext="{Binding IssueExpiryVM}">
                            <!-- Toggle -->
                            <HorizontalStackLayout Spacing="12">
                                <!-- Dynamic Label -->
                                <Label Text="{Binding DateLabelText}"
                                       FontAttributes="Bold"
                                       FontSize="14"
                                       VerticalOptions="Center" />
                                <Border Padding="1"
                                        StrokeShape="RoundRectangle 15">

                                    <Border.Triggers>
                                        <DataTrigger TargetType="Border"
                                                     Binding="{Binding IsIssueToggle}"
                                                     Value="True">
                                            <Setter Property="BackgroundColor"
                                                    Value="#007AFF" />
                                        </DataTrigger>

                                        <DataTrigger TargetType="Border"
                                                     Binding="{Binding IsIssueToggle}"
                                                     Value="False">
                                            <Setter Property="BackgroundColor"
                                                    Value="#D0D0D0" />
                                        </DataTrigger>
                                    </Border.Triggers>

                                    <Switch IsToggled="{Binding IsIssueToggle}"
                                            MaximumHeightRequest="18" />
                                </Border>

                            </HorizontalStackLayout>

                            <Label x:Name="LabelExpiryOrIssueDateNote"
                                   FontSize="10">

                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="Note: "
                                              TextColor="Red"
                                              FontAttributes="Bold" />

                                        <Span Text="Licenses and inductions expire. Please ensure you add expiry so the system can email you when your document needs to be updated. Where a document has no expiry, then use the toggle and add the issue date instead."
                                              TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                    </FormattedString>
                                </Label.FormattedText>

                            </Label>

                            <!-- DatePicker -->
                            <DatePicker Date="{Binding DisplayDate}"
                                        MaximumDate="{Binding MaximumDate}"
                                        Format="dd/MM/yyyy" />
                        </VerticalStackLayout>

                        <!-- AddFileNote -->
                        <VerticalStackLayout Grid.Row="5"
                                             Spacing="2"
                                             Margin="0,2,0,2">

                            <Label x:Name="LabelAddFileNote"
                                   FontSize="10">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="Note: "
                                              TextColor="Red"
                                              FontAttributes="Bold" />

                                        <Span Text="The system will only allow single files to be uploaded to one HR group. Therefore you may need to make multiple separate uploads, based on variations to HR Group and description. Where an older document already exists, don’t ADD it again, simply edit the existing document, upload the version over the top with new expiry or issue date. If your licence expires and you are issued a new number please inform Admin; don’t add yourself as a new guard, Admin will edit the record."
                                              TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Add Image Button -->
                            <Button Text="+ Compliance Document"
                                    Clicked="OnPickComplianceDocumentClicked"
                                    BackgroundColor="DodgerBlue"
                                    TextColor="White"
                                    HorizontalOptions="Center"
                                    FontSize="12"
                                    CornerRadius="6"
                                    Margin="0,6,0,0" />
                        </VerticalStackLayout>

                        <!-- File List -->
                        <ScrollView Grid.Row="6"
                                    IsVisible="{Binding IsFilesVisible}"
                                    MaximumHeightRequest="150"
                                    VerticalOptions="Start">
                            <CollectionView x:Name="FilesCollectionEditImage"
                                            ItemSizingStrategy="MeasureAllItems"
                                            VerticalOptions="Start"
                                            Margin="0,5,0,0">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="0"
                                              ColumnDefinitions="*,Auto"
                                              HeightRequest="30"
                                              VerticalOptions="Center">

                                            <!-- File Name -->
                                            <Label Text="{Binding FileName}"
                                                   VerticalOptions="Center"
                                                   Grid.Column="0"
                                                   LineBreakMode="TailTruncation"
                                                   MaxLines="1"
                                                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                                   FontSize="12"
                                                   Margin="2,0" />

                                            <!-- Delete Button -->
                                            <Button Clicked="OnDeleteFileClicked"
                                                    WidthRequest="20"
                                                    HeightRequest="20"
                                                    BackgroundColor="Transparent"
                                                    Padding="0"
                                                    Margin="0"
                                                    Grid.Column="1"
                                                    VerticalOptions="Center">
                                                <Button.ImageSource>
                                                    <FileImageSource File="delete_icon_s.png" />
                                                </Button.ImageSource>
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </ScrollView>

                        <!-- Footer Buttons -->
                        <!-- Save Button -->
                        <Frame Grid.Row="7"
                               x:Name="frame_ButtonSave"
                               HorizontalOptions="FillAndExpand"
                               VerticalOptions="Fill"
                               Padding="5"
                               Margin="0,5,0,5"
                               CornerRadius="15"
                               HasShadow="False"
                               IsVisible="True"
                               HeightRequest="50">
                            <Frame.Background>
                                <LinearGradientBrush>
                                    <GradientStop Color="#007AFF"
                                                  Offset="0.0" />
                                    <GradientStop Color="#0056B3"
                                                  Offset="1.0" />
                                </LinearGradientBrush>
                            </Frame.Background>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnEditSaveComplianceClicked" />
                            </Frame.GestureRecognizers>

                            <Label x:Name="button_label_save"
                                   Text="Save Compliance"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=White, Dark=Black}" />

                        </Frame>

                        <!-- Cancel Button -->
                        <Frame Grid.Row="8"
                               x:Name="frame_ButtonCancel"
                               HorizontalOptions="FillAndExpand"
                               VerticalOptions="Fill"
                               Padding="5"
                               Margin="0,5,0,0"
                               CornerRadius="15"
                               HasShadow="False"
                               IsVisible="True"
                               HeightRequest="50">
                            <Frame.Background>
                                <LinearGradientBrush>
                                    <GradientStop Color="#007AFF"
                                                  Offset="0.0" />
                                    <GradientStop Color="#0056B3"
                                                  Offset="1.0" />
                                </LinearGradientBrush>
                            </Frame.Background>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnClosePopupClicked" />
                            </Frame.GestureRecognizers>

                            <Label x:Name="button_label_cancel"
                                   Text="Cancel"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=White, Dark=Black}" />

                        </Frame>
                    </Grid>

                </ScrollView>
            </Frame>
        </Grid>



    </Grid>
</ContentPage>


